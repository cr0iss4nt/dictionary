{% extends "base.html" %}

{% block title %}Слова{% endblock %}

{% block content %}

<input type="file" id="fileInput" accept=".txt,.rtf" style="display: none;">

<a href="#" onclick="openFileDialog()" class="btn btn-sm btn-success">
    Заполнить словарь
</a>

<script>
function openFileDialog() {
    document.getElementById('fileInput').click();
}

// select file
document.getElementById('fileInput').addEventListener('change', function(e) {
    if (this.files.length === 0) return;

    const file = this.files[0];
    const formData = new FormData();
    formData.append('file', file);

    // loading state
    const btn = document.querySelector('a[onclick="openFileDialog()"]');
    const originalText = btn.textContent;
    btn.textContent = 'Обработка...';
    btn.classList.remove('btn-success');
    btn.classList.add('btn-secondary');
    btn.style.pointerEvents = 'none';

    // send to server
    fetch('/fill', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.redirected) {
            window.location.href = response.url;
        } else if (response.ok) {
            window.location.reload();
        } else {
            throw new Error('Upload failed');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Ошибка при загрузке файла');
        btn.textContent = originalText;
        btn.classList.add('btn-success');
        btn.classList.remove('btn-secondary');
        btn.style.pointerEvents = 'auto';
    });

    // reset file input
    this.value = '';
});
</script>


<a href="{{ url_for('clear') }}" class="btn btn-sm btn-danger"
   onclick="return confirm('Очистить словарь?')">
    Очистить словарь
</a>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Слово</th>
                        <th>Часть речи</th>
                        <th>Основа</th>
                        <th>Окончание</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for word in words %}
                    <tr>
                        <td>{{ word[0] }}</td>
                        <td>{{ word[1] }}</td>
                        <td>{{ word[2] }}</td>
                        <td>{{ word[3] }}</td>
                        <td>{{ word[4] }}</td>
                        <td>
                            <a href="{{ url_for('add_base_and_ending', word=word[1]) }}" class="btn btn-sm btn-info"
                               onclick="return confirm('Разобрать слово по составу?')">
                                Разобрать
                            </a>
                            {% if word[2] == 'NOUN' %}
                            <a href="{{ url_for('make_word_form', word=word[1]) }}" class="btn btn-sm btn-info">
                                Сделать словоформу
                            </a>
                            {% endif %}
                        </td>
                    </tr>


                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>


{% endblock %}